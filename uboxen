#!/bin/bash

# get a module from puppet-forge
function forge()
{
  AUTHOR=$1
  MODULE=$2
  if [ ! -d /etc/puppet/modules/$MODULE ]; then
    sudo puppet module install $AUTHOR/$MODULE
  else
    sudo puppet module upgrade $AUTHOR/$MODULE
  fi
}

# support for etckeeper
function etckeep()
{
  MSG=$1
  [ -x /usr/bin/etckeeper ] && sudo etckeeper commit "$MSG" 
}

forge puppetlabs stdlib
forge puppetlabs inifile
forge puppetlabs apt 
forge puppetlabs vcsrepo 
forge puppetlabs concat 
forge saz sudo
forge thomasvandoren etckeeper
forge garethr docker 
forge willdurand composer 
forge huskycode vim 

MYPATH=$(dirname $0)

etckeep "Before uBoxen run"
sudo puppet apply $MYPATH/uboxen.pp 
etckeep "After uBoxen run"

exit 0
